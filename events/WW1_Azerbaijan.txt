add_namespace = ww1_azerbaijan

# Baku Commune
country_event = {
	id = ww1_azerbaijan.1
	title = ww1_azerbaijan.1.t
	desc = ww1_azerbaijan.1.d
	picture = GFX_report_event_soviet_soldiers
	fire_only_once = yes
	trigger = {
		tag = AZR
		has_global_flag = russian_civil_war
		has_capitulated = no
		NOT = {
			is_subject_of = SOV
			has_government = communism
			has_global_flag = russian_civil_war_end
		}
		owns_state = 229
		any_controlled_state = {
			is_owned_by = ROOT
			NOT = { state = 229 }
		}
	}
	mean_time_to_happen = { days = 10 }
	immediate = {
		hidden_effect = {
			start_civil_war = {
				ideology = communism
				size = 0.2
				capital = 229
				states = { 229 }
				keep_unit_leaders_trigger = {
					always = yes
				}
				keep_political_leader  = yes
				PREV = {
					AZR_stepan_shaumianv = {
						set_nationality = PREV.PREV
					}
				}
				promote_character = AZR_stepan_shaumianv
				add_ideas = standing_alone	
				set_party_name = {
					ideology = communism
					long_name = BAK_communism_party
					name = BAK_communism_party
				}
				set_party_name = {
					ideology = fascism
					long_name = BAK_fascism_party
					name = BAK_fascism_party
				}
				set_party_name = {
					ideology = neutrality
					long_name = BAK_neutrality_party
					name = BAK_neutrality_party
				}
				set_cosmetic_tag = AZR_BAK_communism
				create_country_leader = {
				 	name = BAK_neutrality_party
				 	picture = "gfx/leaders/RUS/RUS_provisional_government.png"
					traits = {
						stout_defender
					}
				 	ideology = authoritarian_democracy
				}
				create_country_leader = {
				 	name = BAK_fascism_party
				 	picture = "gfx/leaders/RUS/RUS_provisional_government.png"
					traits = {
						stout_defender
					}
				 	ideology = stratocracy
				}
				add_popularity = {
					ideology = fascism
					popularity = 0.2
				}
				add_popularity = {
					ideology = neutrality
					popularity = 0.3
				}
			}
			set_state_controller = 229
			BAK = { 
				set_province_controller = 7661
				division_template = {
					name = "Dunsterforce"
					is_locked = yes
					division_names_group = SOV_INF_01
					template_counter = 69
					regiments = {
						infantry = { x = 0 y = 0 }
					}
					support = {
						engineer = {
							x = 0
							y = 0
						}
						artillery = {
							x = 0
							y = 1
						}
					}
				}
				division_template = {
					name = "Baku Army"
					is_locked = yes
					division_names_group = SOV_INF_01
					template_counter = 69
					regiments = {
						infantry = { x = 0 y = 0 }
						infantry = { x = 0 y = 1 }
						infantry = { x = 1 y = 0 }
					}
					support = {
						artillery = {
							x = 0
							y = 0
						}
					}
				}
				229 = {
					create_unit = {
						division = "name = \"Dunsterforce\" division_template = \"Dunsterforce\" start_experience_factor = 1"
						owner = BAK
						prioritize_location = 7661
						allow_spawning_on_enemy_provs = yes
					}
					create_unit = {
						division = "name = \"Baku Army Garrison\" division_template = \"Baku Army\" start_experience_factor = 0"
						owner = BAK
						count = 2
						prioritize_location = 7661
						allow_spawning_on_enemy_provs = yes
					}
				}
			}
			if = {
				limit = {
					RUS = { has_war_with = SOV }
				}
				RUS = {
					declare_war_on = {
						target = BAK
						type = puppet_wargoal_focus
					}
				}
			}
		}
		AZR = { country_event = ww1_azerbaijan.3 }
	}
	option = {
		name = ww1_azerbaijan.1.a
		effect_tooltip = {
			BAK = {
				declare_war_on = {
					target = ROOT
					type = civil_war
				}
			}
		}
	}
	option = {
		name = ww1_azerbaijan.1.b
		trigger = { is_ai = no }
		BAK = {
			effect_tooltip = {
				declare_war_on = {
					target = ROOT
					type = civil_war
				}
			}
			change_tag_from = ROOT
		}
	}
}

# Centrocaspian Dictatorship
country_event = {
	id = ww1_azerbaijan.2
	title = ww1_azerbaijan.2.t
	desc = ww1_azerbaijan.2.d
	picture = GFX_report_event_soviet_soldiers
	fire_only_once = yes
	trigger = {
		tag = BAK
		has_civil_war = yes
		is_subject = no
		has_government = communism
	}
	mean_time_to_happen = { days = 30 }
	option = {
		name = ww1_azerbaijan.2.a
		if = {
			limit = {
				RUS = {
					has_war_with = ROOT
					NOT = { has_government = communism }
				}
			}
			white_peace = RUS
		}	
		set_politics = {
			ruling_party = neutrality
			elections_allowed = no
		}	
		add_popularity = {
			ideology = neutrality
			popularity = 0.2
		}
	}
}

# Islamic Army arriving to help AZR
country_event = {
	id = ww1_azerbaijan.3
	title = ww1_azerbaijan.3.t
	desc = ww1_azerbaijan.3.d
	picture = GFX_report_event_soviet_soldiers
	fire_only_once = yes
	is_triggered_only = yes
	immediate = {
		hidden_effect = {
			AZR = { 
				division_template = {
					name = "Islamic Army of the Caucasus"
					is_locked = yes
					division_names_group = SOV_INF_01
					template_counter = 69
					regiments = {
						infantry = { x = 0 y = 0 }
						infantry = { x = 0 y = 1 }
						infantry = { x = 0 y = 2 }
						infantry = { x = 1 y = 0 }
					}
					support = {
						engineer = {
							x = 0
							y = 0
						}
						artillery = {
							x = 0
							y = 1
						}
					}
				}
				229 = {
					create_unit = {
						division = "name = \"5th Caucasian Infantry Division\" division_template = \"Islamic Army of the Caucasus\" start_experience_factor = 0.6"
						owner = AZR
						prioritize_location = 7495
						allow_spawning_on_enemy_provs = yes
					}
					create_unit = {
						division = "name = \"15th Infantry Division\" division_template = \"Islamic Army of the Caucasus\" start_experience_factor = 0.6"
						owner = AZR
						prioritize_location = 1536
						allow_spawning_on_enemy_provs = yes
					}
				}
				add_equipment_to_stockpile = {
					type = infantry_equipment
					amount = 1500
					producer = TUR
				}
				add_equipment_to_stockpile = {
					type = artillery_equipment
					amount = 50
					producer = TUR
				}
			}
		}
	}
	option = {
		name = ww1_azerbaijan.3.a
	}
}
