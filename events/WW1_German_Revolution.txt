add_namespace = freikorps

# Spartakist Revolution Put Down
###################################
country_event = {
	id = freikorps.2
	title = freikorps.2.t
	desc = freikorps.2.d
	picture = GFX_report_event_ger_civil_war
	is_triggered_only = yes
	#The Spartakists are captured and killed
	option = {
		name = freikorps.2.a
		ai_chance = { factor = 20 }
		add_stability = -0.03
		add_popularity = {
			ideology = communism
			popularity = -0.03
		}
		retire_character = GER_karl_liebknecht
		retire_character = GER_rosa_luxemburg
		promote_character = GER_ernst_thalmann
		add_manpower = -500
		hidden_effect = {
			BAY = { retire_character = BAY_karl_liebknecht }
			set_global_flag = karl_leibknecht_dead
			
			# Kapp Putsch
			country_event = {
				id = ww1_germany.108
				days = 410 #h1stor1cal
			}
		}
	}
	#The Spartakists escape to Bavaria Soviet Republic
	option = {
		name = freikorps.2.b
		trigger = {
			NOT = {
				has_global_flag = prussian_blue
			}	
		}
		ai_chance = {
			base = 10
			modifier = {
				is_historical_focus_on = yes
				factor = 0
			}
			modifier = {
				NOT = { has_global_flag = russian_revolution }
				add = 100
			}
		}
		add_manpower = -750
		hidden_effect = {
			country_event = { id = freikorps.3 days = 65 }
			set_global_flag = spartakist_in_bavaria
		}
	}
}

# Germany Collapses to Spartakists
#####################################
country_event = {
	id = freikorps.3
	title = freikorps.3.t
	desc = freikorps.3.d
	picture = GFX_report_event_ger_civil_war
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		hidden_effect = {
			every_owned_state = {
				limit = {
					is_core_of = HAN
				}
				transfer_state_to = HAN
			}
			if = {
				limit = {
					has_subject = HAN
				}
				end_puppet = HAN
			}
			every_owned_state = {
				limit = {
					is_core_of = BAY
				}
				transfer_state_to = BAY
			}
			if = {
				limit = {
					has_subject = BAY
				}
				end_puppet = BAY
			}
			every_owned_state = {
				limit = {
					is_core_of = SAX
				}
				transfer_state_to = SAX
			}
			if = {
				limit = {
					has_subject = SAX
				}
				end_puppet = SAX
			}
			every_owned_state = {
				limit = {
					is_core_of = WUR
				}
				transfer_state_to = WUR
			}
			if = {
				limit = {
					has_subject = WUR
				}
				end_puppet = WUR
			}
			every_owned_state = {
				limit = {
					is_core_of = SHL
				}
				transfer_state_to = SHL
			}
			if = {
				limit = {
					has_subject = SHL
				}
				end_puppet = SHL
			}
			if = {
				limit = {
					owns_state = 57
				}
				57 = {
					add_core_of = HAN
					transfer_state_to = HAN
				}
			}
			if = {
				limit = {
					owns_state = 873
				}
				873 = {
					add_core_of = HAN
					transfer_state_to = HAN
				}
			}
			GER = {
				GER_lepold_von_bayern = {
					set_nationality = BAY
				}
				GER_rupprecht_von_wittelsbach = {
					set_nationality = BAY
				}
				GER_friedrich_august_iii = {
					set_nationality = SAX
				}
				GER_albrecht_von_wurttemberg = {
					set_nationality = WUR
				}
			}
			BAY = {
				BAY_karl_liebknecht = {
					add_country_leader_role = {
						country_leader = {
							ideology = marxism
						}
					}
					promote_character = marxism
				}
				add_popularity = {
					ideology = communism
					popularity = 0.50
				}
				set_politics = {
					ruling_party = communism
					elections_allowed = no
				}
				set_party_name = {
					ideology = communism
					long_name = GER_communism_party_interwar_long
					name = GER_communism_party_interwar
				}
				every_state = {
					limit = {
						is_core_of = GER
					}
					add_core_of = PREV
				}
				set_cosmetic_tag = BAY_germany
				set_country_flag = great_war_loser
			}
			WUR = {
				add_popularity = {
					ideology = democratic
					popularity = 0.50
				}
				set_politics = {
					ruling_party = democratic
					elections_allowed = yes
				}
				set_country_flag = great_war_loser
			}
			SHL = {
				add_popularity = {
					ideology = fascism
					popularity = 0.50
				}
				set_politics = {
					ruling_party = fascism
				}
				add_ideas = SHL_kiel_canal_profits
				set_country_flag = great_war_loser
			}
			transfer_units_fraction= {
				target = BAY
				size = 0.3
				stockpile_ratio = 0.4
				army_ratio = 0.3
				navy_ratio = 0.0
				air_ratio = 0.1
			}
			transfer_units_fraction= {
				target = WUR
				size = 0.1
				stockpile_ratio = 0.1
				army_ratio = 0.1
				navy_ratio = 0.0
				air_ratio = 0.1
			}
			transfer_units_fraction= {
				target = HAN
				size = 0.2
				stockpile_ratio = 0.5
				army_ratio = 0.4
				navy_ratio = 0.4
				air_ratio = 0.3
			}
			country_event = { id = freikorps.4 days = 1 }
			HAN = {
				country_event = { id = freikorps.6 hours = 15 } 
				add_popularity = {
					ideology = neutrality
					popularity = 0.5
				}
				set_politics = {
					ruling_party = neutrality
					elections_allowed = no
				}
				set_country_flag = great_war_loser
			}
			news_event = { id = freikorps.5 hours = 2 }
			# Fix Memel
			every_state = {
				limit = {
					is_owned_by = GER
					state = 188
				}
				every_country = {
					limit = {
						owns_state = 11
					}
					transfer_state = PREV
				}
			}
		}
	}
	# Stay as Germany
	option = {
		name = freikorps.3.a
		ai_chance = {
			factor = 100
		}
	}
	# Play as Hanover
	option = {
		name = freikorps.3.b
		ai_chance = {
			factor = 0
		}
		HAN = { change_tag_from = ROOT }
	}
	# Play as Bavaria
	option = {
		name = freikorps.3.c
		ai_chance = {
			factor = 0
		}
		BAY = { change_tag_from = ROOT }
	}
}
# Battle for Frankfurt
#########################
country_event = {
	id = freikorps.4
	title = freikorps.4.t
	desc = freikorps.4.d
	picture = GFX_report_event_ger_civil_war
	is_triggered_only = yes
	fire_only_once = yes
	# Hanoverians win
	option = {
		name = freikorps.4.a
		ai_chance = { factor = 50 }
		HAN = { transfer_state = 55 }
		hidden_effect = {
			BAY = {
				create_wargoal = {
    					type = civil_war
    					target = WUR
				}
			}
		}
	}
	# Wurretemburgians win
	option = {
		name = freikorps.4.b
		ai_chance = { factor = 10 }
		WUR = {
			add_state_core = 55
			transfer_state = 55
		}
		hidden_effect = {
			BAY = {
				create_wargoal = {
    					type = civil_war
    					target = WUR
				}
			}
		}
	}
	# Spartakists win
	option = {
		name = freikorps.4.c
		ai_chance = { factor = 40 }
		BAY = { transfer_state = 55 }
	}
}
# German Collapse - News Event
#################################
news_event = {
	id = freikorps.5
	title = freikorps.5.t
	desc = freikorps.5.d
	picture = GFX_news_event_ger_civil_war
	is_triggered_only = yes
	major = yes
	option = {
		name = freikorps.5.a
		ai_chance = { factor = 100 }
	}
}

# King of Hannover Assassinated
##################################
country_event = {
	id = freikorps.6
	title = freikorps.6.t
	desc = freikorps.6.d
	picture = GFX_report_event_german_reichstag_gathering
	is_triggered_only = yes
	fire_only_once = yes
	option = {
		name = freikorps.6.a
		hidden_effect = { news_event = { id = freikorps.7 hours = 1 } }
		retire_character = HAN_ernest_augustus
		hidden_effect = {
			HAN_victoria_ii = {
				add_country_leader_role = {
					promote_leader = yes
					country_leader = {
						ideology = autocracy
						traits = { imperial_connections kaiserin_of_the_people }
					}
				}
			}
		}
		set_cosmetic_tag = HAN_germany
		hidden_effect = {
			every_state = {
				limit = {
					is_core_of = GER
				}
				add_core_of = PREV
			}
		}
	}
}
# King of Hannover Assassinated - News Event
###############################################
news_event = {
	id = freikorps.7
	title = freikorps.7.t
	desc = freikorps.7.d
	picture = GFX_news_event_ger_civil_war
	is_triggered_only = yes
	major = yes
	option = {
		name = freikorps.7.a
		ai_chance = { factor = 100 }
	}
}

# Reunification Wars
#######################
country_event = {
	id = freikorps.8
	title = freikorps.8.t
	desc = freikorps.8.d
	is_triggered_only = yes
	immediate = {
		hidden_effect = {
			set_global_flag = german_reunification_wars
		}
	}
	option = {
		name = freikorps.8.a
		if = {
			limit = {
				tag = BAY
			}
			if = {
				limit = {
					has_government = communism
				}
				create_faction = komintern
				every_other_country = {
					limit = {
						OR = {
							tag = WUR
							tag = HAN
							tag = GER
							tag = SHL
							tag = SAX
						}
						has_government = communism
					}
					PREV = { add_to_faction = PREV }
				}
			}
			every_other_country = {
				limit = {
					OR = {
						tag = WUR
						tag = HAN
						tag = GER
						tag = SHL
						tag = SAX
					}
					NOT = {
						is_subject_of = PREV
						is_in_faction_with = PREV
					}
				}
				PREV = {
					create_wargoal = {
						target = PREV
						type = civil_war
					}
				}
			}
		}
		if = {
			limit = {
				tag = HAN
			}
			if = {
				limit = {
					has_government = neutrality
				}
				create_faction = HAN_germany_neutrality
				every_other_country = {
					limit = {
						OR = {
							tag = WUR
							tag = BAY
							tag = GER
							tag = SHL
							tag = SAX
						}
						has_government = neutrality
					}
					PREV = { add_to_faction = PREV }
				}
			}
			every_other_country = {
				limit = {
					OR = {
						tag = WUR
						tag = BAY
						tag = GER
						tag = SHL
						tag = SAX
					}
					NOT = {
						is_subject_of = PREV
						is_in_faction_with = PREV
					}
				}
				PREV = {
					create_wargoal = {
						target = PREV
						type = civil_war
					}
				}
			}
		}
		if = {
			limit = {
				tag = GER
			}
			if = {
				limit = {
					has_government = democratic
				}
				create_faction = GER_democratic
				every_other_country = {
					limit = {
						OR = {
							tag = WUR
							tag = HAN
							tag = BAY
							tag = SHL
							tag = SAX
						}
						has_government = democratic
					}
					PREV = { add_to_faction = PREV }
				}
			}
			every_other_country = {
				limit = {
					OR = {
						tag = WUR
						tag = HAN
						tag = BAY
						tag = SHL
						tag = SAX
					}
					NOT = {
						is_subject_of = PREV
						is_in_faction_with = PREV
					}
				}
				PREV = {
					create_wargoal = {
						target = PREV
						type = civil_war
					}
				}
			}
		}
	}
}

# Reunification Wars - News Event
####################################
news_event = {
	id = freikorps.9
	title = freikorps.9.t
	desc = freikorps.9.d
	picture = GFX_news_event_ger_civil_war
	is_triggered_only = yes
	fire_only_once = yes
	major = yes
	option = {
		name = freikorps.9.a
        	if = {
			limit = {
				has_game_rule = {
					rule = rule_superevent
					option = DEFAULT
				}
				is_ai = no
			}
			hidden_effect = {
				play_song = "SE_ger_civil_war"
				set_country_flag = se_ger_civil_war
			}
		}	
		ai_chance = { factor = 100 }
	}
}

# German Reunification
#########################
country_event = {
	id = freikorps.10
	title = freikorps.10.t
	desc = freikorps.10.d
	picture = GFX_report_event_german_reichstag_gathering
	fire_only_once = yes
	trigger = {
		has_global_flag = german_reunification_wars
		OR = {
			tag = GER
			tag = HAN
			tag = BAY
		}
		has_war = no
		is_subject = no
		is_faction_leader = yes
		if = {
			limit = {
				tag = GER
			}
			OR = {
				has_subject = HAN
				NOT = { country_exists = HAN }
			}
			OR = {
				has_subject = BAY
				NOT = { country_exists = BAY }
			}
		}
		else_if = {
			limit = {
				tag = HAN
			}
			OR = {
				has_subject = GER
				NOT = { country_exists = GER }
			}
			OR = {
				has_subject = BAY
				NOT = { country_exists = BAY }
			}
		}
		else = {
			OR = {
				has_subject = GER
				NOT = { country_exists = GER }
			}
			OR = {
				has_subject = HAN
				NOT = { country_exists = HAN }
			}
		}
		OR = {
			has_subject = SHL
			NOT = { country_exists = SHL }
			is_in_faction_with = SHL
		}
		OR = {
			has_subject = WUR
			NOT = { country_exists = WUR }
			is_in_faction_with = WUR
		}
		OR = {
			has_subject = SAX
			NOT = { country_exists = SAX }
			is_in_faction_with = SAX
		}
	}
	mean_time_to_happen = { days = 0 }
	immediate = {
		hidden_effect = { news_event = freikorps.11 }
	}
	option = {
		name = freikorps.10.a
		set_capital = { state = 64 }
		add_political_power = 200
		every_other_country = {
			limit = {
				OR = {
					tag = GER
					tag = HAN
					tag = BAY
					tag = SHL
					tag = WUR
					tag = SAX
				}
				OR = {
					is_subject_of = PREV
					is_in_faction_with = PREV
				}
			}
			PREV = {
				annex_country = {
					target = PREV
					transfer_troops = yes
				}
				change_tag_from = PREV
			}
		}
	}
}

# German Reunification - News Event
######################################
news_event = {
	id = freikorps.11
	title = freikorps.11.t
	desc = freikorps.11.d
	picture = GFX_news_event_german_soldiers
	is_triggered_only = yes
	major = yes
	option = {
		name = freikorps.11.a
	}
}
