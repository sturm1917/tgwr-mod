add_namespace = ww1_morocco
add_namespace = ww1_rif

# FRENCH INTERVENTION
########################
country_event = {
	id = ww1_morocco.1
	title = ww1_morocco.1.t
	desc = ww1_morocco.1.d
	picture = GFX_report_event_usa_destroyers
	is_triggered_only = yes
	option = {
		name = ww1_morocco.1.a
		set_global_flag = agadir_crisis
		effect_tooltip = {
			FRA = {
				puppet = ROOT
			}
		}
		hidden_effect = {
			FRA = { country_event = { id = ww1_morocco.2 days = 2 } }
		}
		ai_chance = { base = 100 }
	}
	option = {
		name = ww1_morocco.1.b
		set_global_flag = agadir_crisis
		set_politics = {
			ruling_party = democratic
			elections_allowed = no
		}
		hidden_effect = {
			set_popularities = {
				democratic = 45
				neutrality = 45
				fascism = 8
				communism = 2
			}
		}
		remove_ideas = FRA_idea_moroccan_intervention
		news_event = ww1_morocco.5
		FRA = { country_event = { id = ww1_morocco.3 days = 2 } }
		ai_chance = { base = 0 }
	}
}

# French protectorate in Morocco
country_event = {
	title = ww1_morocco.2.t
	desc = ww1_morocco.2.d
	id = ww1_morocco.2
	picture = GFX_report_event_usa_destroyers

	is_triggered_only = yes
	option = {
		name = ww1_morocco.2.a
		if = {
			limit = { has_subject_autonomy_feature = yes }
			MOR = { set_country_flag = protectorate }
			set_autonomy = {
				target = MOR
				autonomy_state = autonomy_tgwr_protectorate
			}
		}
		else = {
			puppet = MOR
			MOR = { add_ideas = protectorate }
		}
		if = {
			limit = {
				country_exists = SPR
			}
			effect_tooltip = {
				SPR = { transfer_state = 290 transfer_state = 807 }
			}
			hidden_effect = {
				SPR = {
					country_event = {
						id = ww1_morocco.20
						days = 2
					}
				}
			}
		}
		hidden_effect = {
			every_owned_state = {
				limit = { is_core_of = MOR }
				transfer_state_to = MOR
			}
			MOR = {
				set_politics = {
					ruling_party = neutrality
					elections_allowed = no
				}
				set_popularities = {
					neutrality = 100
				}
				set_cosmetic_tag = MOR_FRA
				MOR_mulay_abdelhafid = {
					remove_country_leader_role = {
						ideology = autocracy
					}
				}
				promote_character = MOR_yusef_bin_hassan
			}
			news_event = {
				id = ww1_morocco.4
				hours = 3
			}
		}
		activate_mission_tooltip = GER_misison_agadir_crisis
	}
}

# Moroccan Rebellion
country_event = {
	title = ww1_morocco.3.t
	desc = ww1_morocco.3.d
	id = ww1_morocco.3
	picture = GFX_report_event_usa_destroyers

	is_triggered_only = yes
	option = {
		name = ww1_morocco.3.a
		create_wargoal = {
			type = annex_everything
			target = MOR
		}
		every_state = {
			limit = {
				is_core_of = MOR
				NOT = {
					is_owned_by = ROOT
					state = 699
					state = 743
					state = 783
					state = 807
				}
			}
		}
		add_named_threat = { threat = 3 name = "ww1_morocco.3.t" }
	}
}

# France occupied Fez
news_event = {
	id = ww1_morocco.4
	title = ww1_morocco.4.t
	desc = ww1_morocco.4.d
	picture = EVENT_hoi4tgw_agadir_crisis

	major = yes
	is_triggered_only = yes

	option = {
		name = ww1_morocco.4.a
	}
}

# Moroccan Rebellion
news_event = {
	id = ww1_morocco.5
	title = ww1_morocco.5.t
	desc = ww1_morocco.5.d
	picture = EVENT_hoi4tgw_agadir_crisis

	major = yes
	is_triggered_only = yes

	option = {
		name = ww1_morocco.5.a
	}
}

# German fleet in Agadir
country_event = {
	title = ww1_morocco.6.t
	desc = ww1_morocco.6.d
	id = ww1_morocco.6
	picture = GFX_report_event_usa_destroyers

	is_triggered_only = yes
	option = {
		name = ww1_morocco.6.a
		news_event = ww1_morocco.7
		ai_chance = { factor = 100 }
	}
}

# Agadir Crisis
news_event = {
	id = ww1_morocco.7
	title = ww1_morocco.7.t
	desc = ww1_morocco.7.d
	picture = EVENT_hoi4tgw_agadir_crisis

	major = yes
	is_triggered_only = yes

	option = {
		name = ww1_morocco.7.a
		trigger = {
			NOT = {
				tag = FRA
				tag = GER
			}
		}
	}

	option = {
		name = ww1_morocco.7.b
		trigger = {
			OR = {
				tag = FRA
				tag = GER
			}
		}
	}
}

# Agadir Crisis - Germany Demands Compensation
#################################################
country_event = {
	title = ww1_morocco.8.t
	desc = ww1_morocco.8.d
	id = ww1_morocco.8
	picture = GFX_report_event_usa_destroyers

	is_triggered_only = yes
	option = {
		name = ww1_morocco.8.a
		add_war_support = 0.05
		transfer_state = 769
		GER = {
			transfer_state = 815 
			transfer_state = 814
			country_event = {
				id = ww1_morocco.10
				days = 2
			}
		}
		news_event = ww1_morocco.11
		if = {
			limit = { CMR = { exists = yes } }
			CMR = {
				transfer_state = 815 
				transfer_state = 814
			}
		}
		hidden_effect = {
			add_state_claim = 815
			add_state_claim = 814
			CMR = {
				add_state_core = 814
		   		add_state_core = 815
			}
			CAR = {
				add_state_core = 769
			}
		}
		ai_chance = {
			factor = 100 
			modifier = {
				GER = {
					has_navy_size = {
						size < 70
					}
				}
				factor = 0.5
			}
			modifier = {
				has_war_with = GER
				factor = 0
			}
		}
	}
	option = {
		name = ww1_morocco.8.b
		GER = { country_event = { id = ww1_morocco.12 days = 2 } }
		news_event = ww1_morocco.14
		ai_chance = {
			factor = 10
			modifier = {
				is_historical_focus_on = yes
				NOT = { has_war_with = GER }
				factor = 0
			}
		}
	}
}

# Germany Demands Agadir
##############################
country_event = {
	title = ww1_morocco.9.t
	desc = ww1_morocco.9.d
	id = ww1_morocco.9
	picture = GFX_report_event_usa_destroyers

	is_triggered_only = yes
	option = {
		name = ww1_morocco.9.a
		news_event = ww1_morocco.13
		FRA = {
			every_state = {
				limit = {
					is_core_of = MOR
					is_owned_or_subject_trigger = yes
				}
				add_claim_by = PREV
				transfer_state_to = MOR
			}
			end_puppet = MOR
		}
		GER = {
			if = {
				limit = {
					has_subject_autonomy_feature = yes
				}
				set_autonomy = {
					target = MOR
					autonomy_state = autonomy_tgwr_informal_protectorate
				}
				MOR = { set_country_flag = protectorate }
			}
			else = {
				puppet = MOR
				MOR = { add_ideas = protectorate }
			}
			hidden_effect = {
				MOR = {
					set_politics = {
						ruling_party = neutrality
						elections_allowed = no
					}
					set_popularities = {
						neutrality = 100
					}
					drop_cosmetic_tag = yes
				}
			}
		}
		add_war_support = 0.10
		ai_chance = {
			factor = 80 
			modifier = {
				GER = {
					has_navy_size = {
						size < 70
					}
				}
				factor = 0.5
			}
			modifier = {
				ENG = { is_in_faction_with = FRA }
				factor = 0.5
			}
			modifier = {
				has_war_with = GER
				factor = 0
			}
			modifier = {
				factor = 0
				has_game_rule = {
					rule = ultimatum_on_agadir
					option = WAR_ON_AGADIR
				}
			}
		}
	}
	option = {
		name = ww1_morocco.9.b
		GER = { country_event = { id = ww1_morocco.12 days = 2 } }
		news_event = ww1_morocco.14
		ai_chance = {
			factor = 20
			modifier = {
				is_historical_focus_on = yes
				NOT = {
					has_war_with = GER
					has_game_rule = {
						rule = ultimatum_on_agadir
						option = WAR_ON_AGADIR
					}
				}
				factor = 0
			}
		}
	}
}

# France will pay for Morocco
#####################
country_event = {
	title = ww1_morocco.10.t
	desc = ww1_morocco.10.d
	id = ww1_morocco.10
	picture = GFX_report_event_usa_destroyers

	is_triggered_only = yes
	option = {
		name = ww1_morocco.10.a		
		set_global_flag = agadir_crisis_ends
		effect_tooltip = {
			GER = {
				transfer_state = 815 
				transfer_state = 814				
			}
		}	
		ai_chance = { factor = 100 }
	}
}

# Agadir Crisis Averted
news_event = {
	id = ww1_morocco.11
	title = ww1_morocco.11.t
	desc = ww1_morocco.11.d
	picture = EVENT_hoi4tgw_agadir_crisis

	major = yes
	is_triggered_only = yes

	option = {
		name = ww1_morocco.11.a
		set_global_flag = agadir_crisis_ends
		ai_chance = { factor = 100 }
	}
}

# France refuced to cede the colony
##############################
country_event = {
	title = ww1_morocco.12.t
	desc = ww1_morocco.12.d
	id = ww1_morocco.12
	picture = GFX_report_event_usa_destroyers

	is_triggered_only = yes
	option = {
		name = ww1_morocco.12.a
		create_wargoal = {
			type = take_state_focus
			target = MOR
			generator = { 462 108 } 
		}
		set_global_flag = agadir_crisis_ends
		ai_chance = { factor = 100 }
	}
}

# Germany occupies Western Morocco
news_event = {
	id = ww1_morocco.13
	title = ww1_morocco.13.t
	desc = ww1_morocco.13.d
	picture = EVENT_hoi4tgw_agadir_crisis

	major = yes
	is_triggered_only = yes

	option = {
		name = ww1_morocco.13.a
		set_global_flag = agadir_crisis_ends
		ai_chance = { factor = 100 }
	}
}

# Escalation of the Agadir Crisis
news_event = {
	id = ww1_morocco.14
	title = ww1_morocco.14.t
	desc = ww1_morocco.14.d
	picture = EVENT_hoi4tgw_agadir_crisis

	major = yes
	is_triggered_only = yes

	option = {
		name = ww1_morocco.14.a
		set_global_flag = agadir_crisis_ends
		ai_chance = { factor = 100 }
	}
}

# The crisis period has passed
country_event = {
	title = ww1_morocco.15.t
	desc = ww1_morocco.15.d
	id = ww1_morocco.15
	picture = GFX_report_event_usa_destroyers

	is_triggered_only = yes
	option = {
		name = ww1_morocco.15.a
		add_war_support = -0.1
		add_political_power = -75
		ai_chance = { factor = 100 }
	}
}

# British involvement
country_event = {
	id = ww1_morocco.16
	title = ww1_morocco.16.t
	desc = ww1_morocco.16.d
	picture = GFX_report_event_usa_destroyers
	is_triggered_only = yes
	option = {
		name = ww1_morocco.16.a
		trigger = { tag = FRA }
		add_opinion_modifier = {
			target = FROM
			modifier = HOI4TGW_Opinion_diplomats_bonus
		}
	}
	option = {
		name = ww1_morocco.16.b
		trigger = { tag = GER }
		add_opinion_modifier = {
			target = FROM
			modifier = HOI4TGW_Opinion_diplomats_malus
		}
	}
}

# German financial crisis
country_event = {
	id = ww1_morocco.17
	title = ww1_morocco.17.t
	desc = ww1_morocco.17.d
	picture = GFX_report_event_gathering_protest
	trigger = {
		tag = GER
		has_global_flag = agadir_crisis
		has_completed_focus = GER_moroccan_crisis
		has_active_mission = GER_misison_agadir_crisis
	}
	fire_only_once = yes
	option = {
		name = ww1_morocco.17.a
		add_ideas = GER_financial_crisis_of_agadir
	}
}

# German financial crisis gets worse
country_event = {
	id = ww1_morocco.18
	title = ww1_morocco.18.t
	desc = ww1_morocco.18.d
	picture = GFX_report_event_gathering_protest
	is_triggered_only = yes
	option = {
		name = ww1_morocco.18.a
		swap_ideas = {
			remove_idea = GER_financial_crisis_of_agadir
			add_idea = GER_financial_crisis_of_agadir_2
		}
	}
}

# German Protectorate Interwar
country_event = {
	id = ww1_morocco.19
	title = ww1_morocco.19.t
	desc = ww1_morocco.19.d
	picture = GFX_report_event_arab_protests
	trigger = {
		tag = GER
		has_war = no
		OR = {
			AND = {
				any_owned_state = { is_core_of = MOR }
				NOT = { country_exists = MOR }
			}
			AND = {
				MOR = { NOT = { has_country_flag = great_war_winner } }
				has_country_flag = great_war_winner
				has_completed_focus = GER_moroccan_crisis
			}
		}
		has_global_flag = frankfurt_treaty
	}
	fire_only_once = yes
	option = {
		name = ww1_morocco.19.a
		# Loyal protectorate
		GER = {
			every_owned_state = {
				limit = {
					is_core_of = MOR
					NOT = {
						state = 743
						state = 783
						state = 887
					}
				}
				transfer_state_to = MOR
			}
			if = {
				limit = {
					has_subject_autonomy_feature = yes
				}
				set_autonomy = {
					target = MOR
					autonomy_state = autonomy_tgwr_informal_protectorate
				}
				MOR = { set_country_flag = protectorate }
			}
			else = {
				puppet = MOR
				MOR = { add_ideas = protectorate }
			}
			hidden_effect = {
				MOR = {
					drop_cosmetic_tag = yes
					set_politics = {
						ruling_party = neutrality
						elections_allowed = no
					}
					set_popularities = {
						neutrality = 100
					}
					every_owned_state = {
						limit = { is_claimed_by = OVERLORD }
						remove_claim_by = OVERLORD
					}
				}
			}
		}
	}
	option = {
		name = ww1_morocco.19.b
		# The Germans fools us!
		every_owned_state = {
			limit = { is_core_of = MOR }
			add_compliance = -50
			add_resistance = 30
		}
		ai_chance = { factor = 0 }
	}
}

# Spainish Morocco
country_event = {
	id = ww1_morocco.20
	title = ww1_morocco.20.t
	desc = ww1_morocco.20.d
	picture = GFX_report_event_spr_army_of_africa
	is_triggered_only = yes
	option = {
		name = ww1_morocco.20.a
		transfer_state = 290
		transfer_state = 807
		add_state_claim = 887
	}
}

# Yusef dies
country_event = {
	id = ww1_morocco.21
	title = ww1_morocco.21.t
	desc = ww1_morocco.21.d
	picture = GFX_report_event_generic_funeral
	fire_only_once = yes
	trigger = {
		tag = MOR
		date > 1927.11.1
		has_character = MOR_yusef_bin_hassan
	}
	mean_time_to_happen = {
		days = 17
	}
	option = {
		name = ww1_morocco.21.a
		retire_character = MOR_yusef_bin_hassan
		MOR_muhammad_bin_yusef = {
			add_country_leader_role = {
				country_leader = {
					ideology = semi_constitutional_monarchy
				}
			}
		}
		if = {
			limit = {
				NOT = {
					has_cosmetic_tag = MOR_FRA
					has_cosmetic_tag = MOR_FRA
				}
			}
			promote_character = MOR_muhammad_bin_yusef
		}
	}
}

# Tangier International Zone
country_event = {
	id = ww1_morocco.22
	title = ww1_morocco.22.t
	desc = ww1_morocco.22.d
	picture = GFX_report_event_generic_peaceful_annexation
	trigger = {
		country_exists = TGR
		is_subject = no
		NOT = {
			has_war_with = TGR
			has_war_with = FRA
			has_war_with = MOR
			has_country_flag = great_war_loser
		}
		OR = {
			original_tag = ENG
			original_tag = SPR
			is_neighbor_of = TGR
		}
	}
	fire_only_once = yes
	option = {
		name = ww1_morocco.22.b
		give_guarantee = TGR
		TGR = { give_military_access = ROOT }
	}
}



##########################################################

# The Rif #
# Riffian tribesmen strongly resists the Spanish
country_event = {
	id = ww1_rif.1
	title = ww1_rif.1.t
	desc = ww1_rif.1.d
	picture = GFX_report_event_india_protests
	trigger = {
		tag = SPR
		290 = { is_owned_or_subject_trigger = yes }
	}
	fire_only_once = yes
	option = {
		name = ww1_rif.1.a
		# 290 = {
		# 	add_compliance = -10
		# 	add_resistance = 10
		# }
		add_manpower = -40000
	}
}

# Disaster of Annual
country_event = {
	id = ww1_rif.2
	title = ww1_rif.2.t
	desc = ww1_rif.2.d
	picture = GFX_report_event_spr_army_of_africa
	trigger = {
		tag = SPR
		290 = { is_owned_or_subject_trigger = yes }
		date > 1921.6.1
	}
	fire_only_once = yes
	mean_time_to_happen = { days = 22 }
	option = {
		name = ww1_rif.2.a
		add_manpower = -13363
		add_war_support = -0.05
		RIF = { add_manpower = -800 }
		290 = { set_demilitarized_zone = yes }
		hidden_effect = {
			country_event = {
				id = ww1_rif.3
				days = 20
			}
			set_country_flag = disaster_of_annual
		}
	}
}

# Republic of the Rif Proclaimed
country_event = {
	id = ww1_rif.3
	title = ww1_rif.3.t
	desc = ww1_rif.3.d
	picture = GFX_report_event_spr_army_of_africa
	is_triggered_only = yes
	immediate = {
		hidden_effect = {
			290 = { add_core_of = RIF }
			division_template = {
				name = "Regimiento de guarnición en Marruecos"
				division_names_group = SPR_GAR_01
				regiments = {
					infantry = { x = 0 y = 0 }
					infantry = { x = 0 y = 1 }
					infantry = { x = 1 y = 0 }
					infantry = { x = 1 y = 1 }
				}
			}
			RIF = {
				division_template = {
					name = "Tribesmen"
					regiments = {
						irregular_infantry = { x = 0 y = 0 }
						irregular_infantry = { x = 0 y = 1 }
						irregular_infantry = { x = 0 y = 1 }
						irregular_infantry = { x = 1 y = 0 }
						irregular_infantry = { x = 1 y = 1 }
						irregular_infantry = { x = 1 y = 2 }
					}
				}
			}
		}
	}
	option = {
		name = ww1_rif.3.a
		290 = { set_demilitarized_zone = no }
		RIF = {
			transfer_state = 290
			hidden_effect = {
				PREV = {
					set_province_controller = 4761
					set_province_controller = 12100
					743 = {
						create_unit = {
							division = "name = \"Guarnición de Melilla\" division_template = \"Regimiento de guarnición en Marruecos\" start_experience_factor = 0.3 start_equipment_factor = 1.0"
							owner = ROOT
							prioritize_location = 12082
							allow_spawning_on_enemy_provs = yes
						}
						create_unit = {
							division = "name = \"Guarnición de Ceuta\" division_template = \"Regimiento de guarnición en Marruecos\" start_experience_factor = 0.3 start_equipment_factor = 1.0"
							owner = ROOT
							prioritize_location = 9945
							allow_spawning_on_enemy_provs = yes
						}
						create_unit = {
							division = "name = \"Guarnición de Melilla\" division_template = \"Regimiento de guarnición en Marruecos\" start_experience_factor = 0.3 start_equipment_factor = 1.0"
							owner = ROOT
							prioritize_location = 12082
							allow_spawning_on_enemy_provs = yes
						}
						create_unit = {
							division = "name = \"Guarnición de Ceuta\" division_template = \"Regimiento de guarnición en Marruecos\" start_experience_factor = 0.3 start_equipment_factor = 1.0"
							owner = ROOT
							prioritize_location = 9945
							allow_spawning_on_enemy_provs = yes
						}
					}
				}
				290 = {
					create_unit = {
						division = "name = \"Axdir tribesmen\" division_template = \"Tribesmen\" start_experience_factor = 1.0 start_equipment_factor = 1.0"
						owner = RIF
						prioritize_location = 7215
						allow_spawning_on_enemy_provs = yes
					}
					create_unit = {
						division = "name = \"Chauen tribesmen\" division_template = \"Tribesmen\" start_experience_factor = 1.0 start_equipment_factor = 1.0"
						owner = RIF
						prioritize_location = 12087
						allow_spawning_on_enemy_provs = yes
					}
					create_unit = {
						division = "name = \"Axdir tribesmen\" division_template = \"Tribesmen\" start_experience_factor = 1.0 start_equipment_factor = 1.0"
						owner = RIF
						prioritize_location = 7215
						allow_spawning_on_enemy_provs = yes
					}
					create_unit = {
						division = "name = \"Chauen tribesmen\" division_template = \"Tribesmen\" start_experience_factor = 1.0 start_equipment_factor = 1.0"
						owner = RIF
						prioritize_location = 12087
						allow_spawning_on_enemy_provs = yes
					}
				}
			}
		}
		add_state_claim = 290
		declare_war_on = {
			target = RIF
			type = annex_everything
		}
	}
	option = {
		name = ww1_rif.3.b
		trigger = { is_ai = no }
		290 = { set_demilitarized_zone = no }
		RIF = {
			transfer_state = 290
			hidden_effect = {
				PREV = {
					set_province_controller = 10113
					set_province_controller = 4761
					743 = {
						create_unit = {
							division = "name = \"Guarnición de Melilla\" division_template = \"Regimiento de guarnición en Marruecos\" start_experience_factor = 0.3 start_equipment_factor = 1.0"
							owner = ROOT
							prioritize_location = 12082
							allow_spawning_on_enemy_provs = yes
						}
						create_unit = {
							division = "name = \"Guarnición de Ceuta\" division_template = \"Regimiento de guarnición en Marruecos\" start_experience_factor = 0.3 start_equipment_factor = 1.0"
							owner = ROOT
							prioritize_location = 9945
							allow_spawning_on_enemy_provs = yes
						}
					}
				}
				290 = {
					create_unit = {
						division = "name = \"Axdir tribesmen\" division_template = \"Tribesmen\" start_experience_factor = 1.0 start_equipment_factor = 1.0"
						owner = RIF
						prioritize_location = 7215
						allow_spawning_on_enemy_provs = yes
					}
					create_unit = {
						division = "name = \"Chauen tribesmen\" division_template = \"Tribesmen\" start_experience_factor = 1.0 start_equipment_factor = 1.0"
						owner = RIF
						prioritize_location = 12087
						allow_spawning_on_enemy_provs = yes
					}
				}
			}
		}
		add_state_claim = 290
		declare_war_on = {
			target = RIF
			type = annex_everything
		}
		RIF = { change_tag_from = ROOT }
	}
}

# French Invervention on the Rif?
country_event = {
	id = ww1_rif.4
	title = ww1_rif.4.t
	desc = ww1_rif.4.d
	picture = GFX_report_event_spr_army_of_africa
	is_triggered_only = yes
	option = {
		name = ww1_rif.4.a
		declare_war_on = {
			target = RIF
			type = topple_government
		}
		MOR = {
			add_victory_points = {
				province = 10070
				value = 5
			}
			add_victory_points = {
				province = 7069
				value = -5
			}
			set_capital = {
				state = 462
			}
		}
		if = {
			limit = { has_subject = MOR }
			MOR = {
				add_to_war = {
					targeted_alliance = ROOT
					enemy = RIF
				}
			}
		}
	}
}

# Spanish withdraws from the Rif
country_event = {
	id = ww1_rif.5
	title = ww1_rif.5.t
	desc = ww1_rif.5.d
	picture = GFX_report_event_spr_army_of_africa
	is_triggered_only = yes
	option = {
		name = ww1_rif.5.a
		white_peace = FROM
		if = {
			limit = {
				has_war_with = FRA
			}
			white_peace = FRA
		}
		FROM = {
			every_owned_state = {
				limit = {
					OR = {
						is_core_of = ROOT
						is_claimed_by = ROOT
					}
				}
				transfer_state_to = ROOT
			}
		}
		add_war_support = 0.20
		add_stability = 0.15
		add_political_power = 250
		remove_ideas = standing_alone
	}
}